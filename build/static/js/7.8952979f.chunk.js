webpackJsonp([7],{1121:function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,i){try{var o=t[a](i),c=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(c).then(function(e){r("next",e)},function(e){r("throw",e)});e(c)}return r("next")})}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=n(875),s=(n.n(l),n(876)),u=n.n(s),d=n(78),f=n.n(d),h=n(884),p=(n.n(h),n(885)),m=n.n(p),b=n(0),y=n.n(b),v=n(79),g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),P=m.a.TreeNode,S=function(e){function t(){var e,n,c,l,s=this;i(this,t);for(var u=arguments.length,d=Array(u),h=0;h<u;h++)d[h]=arguments[h];return n=c=o(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(d))),c.state={id:"",menuFunctionList:[]},c.defaultCheckKeys=[],c.checkedKeys=[],c.onCancel=function(){c.props.onCancel(),c.setState({menuFunctionList:[]}),c.defaultCheckKeys=[],c.checkedKeys=[]},c.onOk=a(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={roleId:c.props.formData.id,permissions:c.checkedKeys,moduleId:0},e.next=3,c.props.handFormSubmit(t);case 3:c.setState({menuFunctionList:[]}),c.defaultCheckKeys=[],c.checkedKeys=[];case 6:case"end":return e.stop()}},e,s)})),c.buildMenuListAndFunctions=function(e){var t=function t(n){var a=!0,i=!1,o=void 0;try{for(var c,l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var s=c.value;!function(n){var a=e.filter(function(e){return e.parentId==n.id}),i=n.functions.map(function(e){return e.isPermissionChild=!0,e});a&&a.length>0&&t(a),n.children=[].concat(r(a),r(i))}(s)}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}},n=e.filter(function(e){return 0==e.parentId}),a=!0,i=!1,o=void 0;try{for(var c,l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var s=c.value;!function(n){var a=e.filter(function(e){return e.parentId==n.id}),i=n.functions.map(function(e){return e.isPermissionChild=!0,e});a&&a.length>0&&t(a),n.children=[].concat(r(a),r(i))}(s)}}catch(e){i=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw o}}return n},c.onCheck=function(e,t){c.checkedKeys=e.filter(function(e){return e.indexOf("menu")<0})},c.renderTreeNode=function(e){var t=[],n=!0,r=!1,a=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var l=i.value;l.children&&l.children.length>0?l.isPermissionChild?t.push(y.a.createElement(P,{className:"permission-tree-node",title:l.name,key:l.id},c.renderTreeNode(l.children))):t.push(y.a.createElement(P,{className:"clear-both",title:y.a.createElement("span",{style:{color:"rgb(181, 185, 189)"}},l.title),key:"menu"+l.id},c.renderTreeNode(l.children))):l.isPermissionChild?t.push(y.a.createElement(P,{className:"permission-tree-node",title:l.name,key:l.id})):t.push(y.a.createElement(P,{className:"clear-both",title:y.a.createElement("span",{style:{color:"rgb(181, 185, 189)"}},l.title),key:"menu"+l.id}))}}catch(e){r=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}return t},c.renderTree=function(){return y.a.createElement(m.a,{checkable:!0,multiple:!0,defaultExpandAll:!0,defaultCheckedKeys:c.defaultCheckKeys,onCheck:c.onCheck,selectable:!1},c.renderTreeNode(c.state.menuFunctionList))},l=n,o(c,l)}return c(t,e),g(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(console.log(121212),e.visible){console.log(444444444);var n=e.formData.id;Object(v.getMenuFunctions)({menuId:0,roleId:n}).then(function(e){var n=t.buildMenuListAndFunctions(e.data.menuFunctions),r=e.data.roleFunctions.map(function(e){return e.functionId});t.defaultCheckKeys=r,t.checkedKeys=r,t.setState({menuFunctionList:n})})}}},{key:"render",value:function(){return console.log("render"),y.a.createElement(u.a,{width:800,visible:this.props.visible,cancelText:"关闭",okText:"提交",title:this.props.title,onCancel:this.onCancel,onOk:this.onOk,destroyOnClose:!0},this.state.menuFunctionList.length>0?this.renderTree():null)}}]),t}(y.a.PureComponent);t.a=S},1122:function(e,t,n){var r=n(1123);"string"==typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0};a.transform=void 0,n(11)(r,a),r.locals&&(e.exports=r.locals)},1123:function(e,t,n){t=e.exports=n(10)(void 0),t.push([e.i,".permission-tree-node {\n  float: left;\n  width: 200px;\n}\n",""])},894:function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){function r(a,i){try{var o=t[a](i),c=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(c).then(function(e){r("next",e)},function(e){r("throw",e)});e(c)}return r("next")})}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=n(301),l=(n.n(c),n(302)),s=n.n(l),u=n(867),d=(n.n(u),n(868)),f=n.n(d),h=n(869),p=(n.n(h),n(870)),m=n.n(p),b=n(78),y=n.n(b),v=n(873),g=(n.n(v),n(874)),P=n.n(g),S=n(0),w=n.n(S),k=n(79),x=n(871),O=n(883),C=n(1121),E=n(1122),F=(n.n(E),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),j=function(e){function t(){var e,n,o,c,l=this;a(this,t);for(var s=arguments.length,u=Array(s),d=0;d<s;d++)u[d]=arguments[d];return n=o=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(u))),o.state={tableFilter:{name:"",code:""},searchFormExpand:!0,tablePagedList:[],tablePagination:{current:1,pageSize:10,showQuickJumper:!0,showSizeChanger:!0,showTotal:function(e){return"Total "+e+" items"}},tableSorter:{field:"",order:""},tableLoading:!1,editModalVisible:!1},o.columns=[{title:"角色名称",dataIndex:"name",sorter:!0},{title:"角色编码",dataIndex:"code",sorter:!0},{title:"操作",dataIndex:"id",fixed:"right",width:120,render:function(e,t){return w.a.createElement("div",null,w.a.createElement("a",{href:"javascript:;",onClick:function(){return o.editRolePermission(t)}},"编辑角色权限"))}}],o.editFormData={},o.handleSearch=function(e){var t=Object.assign({},o.state.tablePagination);t.current=1,o.setState({tableFilter:e,tablePagination:t});var n={pageIndex:1,pageSize:o.state.tablePagination.pageSize,sortBy:o.state.tableSorter.field,descending:"descend"===o.state.tableSorter.order,filter:e};o.fetch(n)},o.handleReset=function(){o.setState({tableFilter:{}})},o.handleTableChange=function(e,t,n){var r=Object.assign({},o.state.tablePagination);r.current=e.current,r.pageSize=e.pageSize,o.setState({tablePagination:r,tableSorter:{field:n.field,order:n.order}});var a={pageIndex:r.current,pageSize:r.pageSize,sortBy:n.field,descending:"descend"===n.order,filter:o.state.tableFilter};o.fetch(a)},o.editRolePermission=function(e){o.editFormData=Object.assign({},e),console.log(o.editFormData),o.setState({editModalVisible:!0})},o.editModalOnCancel=function(){o.setState({editModalVisible:!1})},o.saveRolePermission=function(){var e=r(y.a.mark(function e(t){var n;return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object.assign({},t),e.prev=1,e.next=4,Object(k.savePermission)(n);case 4:P.a.success({placement:"bottomLeft bottomRight",message:"保存成功"}),o.setState({editModalVisible:!1}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(1);case 10:case"end":return e.stop()}},e,l,[[1,8]])}));return function(t){return e.apply(this,arguments)}}(),o.refresh=function(){var e={pageIndex:o.state.tablePagination.current,pageSize:o.state.tablePagination.pageSize,sortBy:o.state.tableSorter.field,descending:"descend"===o.state.tableSorter.order,filter:o.state.tableFilter};o.fetch(e)},o.fetch=r(y.a.mark(function e(){var t,n,r,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return y.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o.setState({tableLoading:!0}),e.next=3,Object(k.getRolePagedList)(a);case 3:t=e.sent,n=t.data,r=Object.assign({},o.state.tablePagination),r.total=n.totalCount,o.setState({tableLoading:!1,tablePagedList:n.rows,tablePagination:r});case 8:case"end":return e.stop()}},e,l)})),c=n,i(o,c)}return o(t,e),F(t,[{key:"componentDidMount",value:function(){this.refresh()}},{key:"render",value:function(){return console.log("RolePermission render"),w.a.createElement("div",null,w.a.createElement(x.a,{schema:O.a.searchSchema,uiSchema:O.a.searchUiSchema,handleSubmit:this.handleSearch,handleReset:this.handleReset}),w.a.createElement(m.a,null),w.a.createElement(f.a,{columns:this.columns,rowKey:function(e){return e.id},dataSource:this.state.tablePagedList,pagination:this.state.tablePagination,loading:this.state.tableLoading,onChange:this.handleTableChange,scroll:{x:768},bordered:!0}),w.a.createElement(C.a,{visible:this.state.editModalVisible,title:w.a.createElement("span",null,"编辑角色  ",w.a.createElement(s.a,{color:"#2db7f5"},this.editFormData.name)," 权限"),onCancel:this.editModalOnCancel,formData:this.editFormData,handFormSubmit:this.saveRolePermission}))}}]),t}(w.a.PureComponent);t.default=j}});
//# sourceMappingURL=7.8952979f.chunk.js.map